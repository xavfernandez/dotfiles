[user]
    name = Xavier Fernandez
    email = xavier.fernandez@beta.gouv.fr

[color]
    ui = auto

[color "branch"]
    current = yellow reverse
    local = yellow
    remote = green

[color "diff"]
    meta = yellow bold
    frag = magenta bold
    old = red bold
    new = green bold

[color "status"]
    added = yellow
    changed = green
    untracked = cyan

[commit]
    verbose = true

[alias]
    st = status
    ci = commit
    br = branch
    co = checkout
    df = diff
    dc = diff --cached
    lg = log -p
    pr = pull --rebase
    p = push
    lol = log --graph --decorate --pretty=oneline --abbrev-commit
    lolanoclever = log --graph --decorate --pretty=oneline --abbrev-commit --exclude=refs/heads/master_clever --exclude=refs/remotes/origin/master_clever --all
    lola = log --graph --decorate --pretty=oneline --abbrev-commit --all
    latest=for-each-ref --sort=-taggerdate --format='%(refname:short)' --count=1
    pr-fetch  = "!f() { git fetch -fu ${2:-origin} refs/pull/$1/head:pr/$1 && git checkout pr/$1; }; f"
    pr-clean = "!git for-each-ref refs/heads/pr/* --format='%(refname)' | while read ref ; do branch=${ref#refs/heads/} ; git branch -D $branch ; done"
    pf = push --force-with-lease --force-if-includes
    # From https://fortes.com/2022/make-git-better-with-fzf/
    addm = "!git ls-files --deleted --modified --other --exclude-standard | fzf -0 -m --preview 'git diff --color=always {-1}' | xargs -r git add"
    addmp = "!git ls-files --deleted --modified --exclude-standard | fzf -0 -m --preview 'git diff --color=always {-1}' | xargs -r -o git add -p"
    cb = "!git branch --all | grep -v '^[*+]' | awk '{print $1}' | fzf -0 --preview 'git show --color=always {-1}' | sed 's/remotes\\/origin\\///g' | xargs -r git checkout"
    cs = "!git stash list | fzf -0 --preview 'git show --pretty=oneline --color=always --patch \"$(echo {} | cut -d: -f1)\"' | cut -d: -f1 | xargs -r git stash pop"
    db = "!git branch | grep -v '^[*+]' | awk '{print $1}' | fzf -0 --multi --preview 'git show --color=always {-1}' | xargs -r git branch --delete"
    Db = "!git branch | grep -v '^[*+]' | awk '{print $1}' | fzf -0 --multi --preview 'git show --color=always {-1}' | xargs -r git branch --delete --force"
    ds = "!git stash list | fzf -0 --preview 'git show --pretty=oneline --color=always --patch \"$(echo {} | cut -d: -f1)\"' | cut -d: -f1 | xargs -r git stash drop"
    edit = "!git ls-files --modified --other --exclude-standard | sort -u | fzf -0 --multi --preview 'git diff --color {}' | xargs -r $EDITOR -p"
    fixup = "!git log --oneline --no-decorate --no-merges | fzf -0 --preview 'git show --color=always --format=oneline {1}' | awk '{print $1}' | xargs -r git commit --fixup"
    resetm = "!git diff --name-only --cached | fzf -0 -m --preview 'git diff --color=always {-1}' | xargs -r git reset"

[push]
    default = upstream

[url "git@github.com:Polyconseil/"]
    insteadOf = poly:

[merge]
    tool = meld
[core]
    excludesfile = ~/.gitignore_global
[credential]
    helper = /usr/lib/git-core/git-credential-gnome-keyring

[branch]
    autosetuprebase = always

[fetch]
    prune = true

[sendemail]
    smtpEncryption = tls
    smtpServer = smtp.gmail.com
    smtpUser = xav.fernandez@gmail.com
    smtpServerPort = 587

[diff "ansible-vault"]
    cachetextconv = false
    textconv = "ansible-vault view"
